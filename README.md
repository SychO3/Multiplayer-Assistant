# Stardew Valley Multiplayer Assistant (无人值守服务器)

Stardew Valley Multiplayer Assistant 是一个专为《星露谷物语》多人联机设计的 SMAPI Mod，作为房主(主机)的无人值守服务器机器人，自动管理游戏进程、节日活动和玩家互动。

## 核心功能概述

### 🎮 服务器自动化管理
- **无人值守运行**: 房主可以挂机运行，自动处理游戏流程
- **智能暂停系统**: 当没有玩家在线时自动暂停游戏，有玩家时恢复
- **自动睡觉机制**: 在指定时间自动让角色睡觉进入下一天
- **技能等级管理**: 可选择自动将技能等级设置为满级，关闭服务器时恢复原等级

### 🎭 节日活动自动化
支持所有主要节日的自动参与和管理：
- **春季**: 复活节彩蛋节、花舞节
- **夏季**: 夏日狂欢节、月光水母舞
- **秋季**: 星露谷农产品展、万圣节
- **冬季**: 冰雪节、冬日星盛宴

### 💬 聊天命令系统
玩家可通过聊天命令控制服务器：
- `!sleep` - 提前睡觉
- `!festival` - 前往节日现场
- `!event` - 开始节日活动
- `!leave` - 离开节日
- `!unstick` - 传送脱困
- `!pause` / `!unpause` - 暂停/恢复游戏（可配置）

### 🏠 房屋和设施管理
- **房屋升级**: 自动设置房屋升级等级
- **洞穴选择**: 自动选择蘑菇洞穴或果蝠洞穴
- **宠物命名**: 自动设置宠物名称
- **社区中心/JJ超市**: 支持自动推进社区中心或JJ超市路线

### 🔒 多人游戏保护
- **箱子锁定**: 防止其他玩家访问房主的私人箱子
- **邀请码管理**: 自动复制邀请码到剪贴板并保存到文件
- **玩家统计**: 实时显示在线玩家数量

## 详细功能说明

### 服务器控制系统
- **快捷键控制**: 默认 F9 键开启/关闭服务器模式
- **控制台命令**: `server` 命令切换服务器状态
- **调试模式**: `debug_server` 命令启用调试模式，允许无玩家时运行

### 自动化游戏进程
1. **每日流程管理**:
   - 6:10 AM: 自动检查邮箱（一天10次）
   - 6:30 AM: 解锁锈钥匙、推进社区中心/JJ超市进度
   - 6:40 AM: 自动外出到农场
   - 9:00 AM: 获取钓鱼竿（如未获得）

2. **节日管理**:
   - 自动检测节日日期
   - 在正确时间传送到节日地点
   - 自动开始节日活动
   - 设置超时保护防止卡死

3. **睡眠管理**:
   - 可配置的自动睡眠时间
   - 获取正确的床铺坐标（根据房屋升级等级）
   - 处理装运菜单的自动点击

### 防卡死和错误处理
- **对话框自动点击**: 自动处理随机出现的对话框
- **事件跳过**: 自动跳过可跳过的事件
- **超时重置**: 各种活动都有超时保护，防止游戏卡死
- **装运菜单处理**: 自动处理日终装运菜单

### 好感度保护
- **友谊度锁定**: 防止NPC好感度下降
- **自动维护**: 每日自动维护所有NPC关系

### 数据管理
- **技能数据保存**: 保存玩家原始技能等级和经验
- **配置热重载**: 支持运行时重新加载配置
- **状态持久化**: 游戏状态的自动保存和恢复

## 配置选项

### 基础设置
- `serverHotKey`: 服务器开关快捷键（默认 F9）
- `autoLevel`: 是否自动满级技能（默认 true）
- `profitmargin`: 利润倍率（默认 100%）
- `timeOfDayToSleep`: 自动睡眠时间（默认 22:00）

### 房屋和宠物
- `upgradeHouse`: 房屋升级等级（0-3）
- `petname`: 宠物名称
- `farmcavechoicemushrooms`: 选择蘑菇洞穴（true）或果蝠洞穴（false）

### 游戏路线选择
- `communitycenterrun`: 选择社区中心路线（true）或JJ超市路线（false）

### 多人游戏设置
- `lockPlayerChests`: 是否锁定其他玩家的箱子
- `clientsCanPause`: 是否允许客户端暂停游戏
- `copyInviteCodeToClipboard`: 是否自动复制邀请码

### 节日设置
- `festivalsOn`: 是否启用节日功能
- 各节日倒计时配置（秒）
- 各节日超时设置（秒）

### 聊天命令关键词
- `sleepKeyword`: 睡觉命令关键词
- `festivalKeyword`: 节日命令关键词
- `eventKeyword`: 活动命令关键词
- `leaveKeyword`: 离开命令关键词
- `unstickKeyword`: 脱困命令关键词
- `pauseKeyword` / `unpauseKeyword`: 暂停/恢复命令关键词

## 使用方法

1. **启动服务器模式**:
   - 按 F9 键或在控制台输入 `server` 命令
   - 服务器模式开启后会显示状态信息

2. **玩家命令使用**:
   - 在聊天中输入 `!sleep` 提前睡觉
   - 在节日当天输入 `!festival` 前往节日
   - 在节日现场输入 `!event` 开始活动

3. **配置调整**:
   - 编辑 `config.json` 文件调整各项设置
   - 重新加载游戏或重启 Mod 生效

## 显示信息

当服务器模式开启时，游戏左上角会显示：
- 服务器状态（开/关）
- 控制快捷键提示
- 当前利润倍率
- 在线玩家数量
- 邀请码（如果有）

## 文件输出

Mod 会在其文件夹中生成：
- `InviteCode.txt`: 当前邀请码
- `ConnectionsCount.txt`: 在线玩家数量
- `data/[存档名].json`: 玩家技能数据备份

## 技术特性

- **基于 .NET 6.0**: 使用现代 C# 语法
- **完整日志系统**: 使用 MonitorExtensions 进行详细日志记录
- **性能优化**: 智能的游戏状态检查和事件处理
- **错误恢复**: 完善的异常处理和恢复机制
- **多语言支持**: 使用 i18n 国际化框架

## 安装要求

- SMAPI 3.9.0 或更高版本
- .NET 6.0 运行时
- 《星露谷物语》1.5.2 或更高版本

## 注意事项

1. **房主专用**: 此 Mod 专为房主设计，客户端玩家无需安装
2. **备份存档**: 使用前请备份游戏存档
3. **网络稳定**: 确保网络连接稳定，避免连接中断
4. **配置合理**: 根据实际需要调整超时和倒计时设置
